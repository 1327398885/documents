(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{333:function(t,e,a){"use strict";a.r(e);var r=a(24),s=Object(r.a)({},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#介绍","aria-hidden":"true"}},[t._v("#")]),t._v(" 介绍")]),t._v(" "),a("p",[t._v("在初学时注释过"),a("a",{attrs:{href:"/backend/nginx/explain-the-main-configuration-file-of-nginx"}},[t._v("配置文件")]),t._v("，就以为是详解了～")]),t._v(" "),a("p",[t._v("其实每个参数都有比较复杂的用法，详情可见 Nginx 的 "),a("a",{attrs:{href:"https://nginx.org/en/docs/dirindex.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("directives"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("h2",{attrs:{id:"listen"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#listen","aria-hidden":"true"}},[t._v("#")]),t._v(" "),a("a",{attrs:{href:"https://nginx.org/en/docs/http/ngx_http_core_module.html#listen",target:"_blank",rel:"noopener noreferrer"}},[t._v("listen"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("需要监听的端口。")]),t._v(" "),a("div",{staticClass:"danger custom-block"},[a("p",[t._v("在官网的链接中需要注意的是：")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("Syntax（语法），语法没啥好说的。")])]),t._v(" "),a("li",[a("p",[t._v("Context（上下文），上下文即大括号 "),a("code",[t._v("{}")]),t._v(" 的范围内，如 listen 仅可以写在 server 上下文中，不能写在 http 和 location 的上下文中。")])])])]),t._v(" "),a("h2",{attrs:{id:"server-name"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#server-name","aria-hidden":"true"}},[t._v("#")]),t._v(" "),a("a",{attrs:{href:"https://nginx.org/en/docs/http/ngx_http_core_module.html#server_name",target:"_blank",rel:"noopener noreferrer"}},[t._v("server_name"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("此处为是 core module 的介绍，其余模块与之相关的也有很多。")]),t._v(" "),a("p",[t._v("这边比较重要的是 Server 的匹配顺序：")]),t._v(" "),a("ol",[a("li",[t._v("精确匹配；")]),t._v(" "),a("li",[a("code",[t._v("*")]),t._v(" 在前的泛域名；")]),t._v(" "),a("li",[a("code",[t._v("*")]),t._v(" 在后的泛域名；")]),t._v(" "),a("li",[t._v("按文件中的顺序匹配正则表达式域名；")]),t._v(" "),a("li",[t._v("default server  "),a("Badge",{attrs:{text:"重点",type:"error"}}),t._v("。未声明时指向文件第一个 server。")],1)]),t._v(" "),a("div",{staticClass:"danger custom-block"},[a("p",[t._v("在之前有多个项目时，有部分应用限制 IP 访问，结果我在删除原项目地址后，忘记关闭 DNS 解析了，恰好限制访问的应用 server 又排在第一个，时隔好久访问自己的域名才发现裸奔很久了 😭。")])]),t._v(" "),a("h3",{attrs:{id:"_1-示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-示例","aria-hidden":"true"}},[t._v("#")]),t._v(" 1. 示例")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tlisten    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v(" default_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 在 listen 后追加，而非 server_name")]),t._v("\n\tserver_name  www.shanyuhai.top shanyuhai.top"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"_2-注意"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-注意","aria-hidden":"true"}},[t._v("#")]),t._v(" 2. 注意")]),t._v(" "),a("p",[t._v("在部分文章中注意到，如果你想要提高自己的网站的知名度，那么还需要配合 301 进行跳转，否则该项设置会导致搜索引擎收录他人的站点，而非你的。")]),t._v(" "),a("h2",{attrs:{id:"rewrite"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rewrite","aria-hidden":"true"}},[t._v("#")]),t._v(" "),a("a",{attrs:{href:"https://nginx.org/en/docs/http/ngx_http_rewrite_module.html#rewrite",target:"_blank",rel:"noopener noreferrer"}},[t._v("rewrite"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("该指令可以用于修改访问的 URL，对应的语法为：")]),t._v(" "),a("div",{staticClass:"danger custom-block"},[a("p",[t._v("rewrite regex replacement [flag]")])]),t._v(" "),a("p",[t._v("flag 具有以下参数：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("flag")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("last")]),t._v(" "),a("td",[t._v("使用更改的 URI 匹配新位置。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("break")]),t._v(" "),a("td",[t._v("停止处理当前的指令集。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("redirect")]),t._v(" "),a("td",[t._v("返回 302 （临时）重定向。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("permanent")]),t._v(" "),a("td",[t._v("返回 301 （永久）重定向。")])])])]),t._v(" "),a("p",[t._v("近期在升级站点到 https 时就用到了该语法：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("rewrite ^"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(".*"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" https://"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$host")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$1")]),t._v(" permanent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 及 Certbot 自动配置的")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$host")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" blog.shanyuhai.top"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("301")]),t._v(" https://"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$host")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_uri")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# managed by Certbot")]),t._v("\n")])])])])},[],!1,null,null,null);e.default=s.exports}}]);